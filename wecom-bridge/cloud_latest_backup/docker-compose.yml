services:
  wecom-bridge:
    build: ./app
    container_name: wecom-bridge
    restart: unless-stopped
    ports:
      - "3001:3001"
    env_file: .env
    networks:
      - chatwoot_default
      - default
    volumes:
      - ./logs:/app/logs
      - ./wecom_bridge.db:/app/wecom_bridge.db
      - ./app/knowledge_base.json:/app/knowledge_base.json
      - ./app/src:/app/src

  mock-provider:
    image: python:3.12-slim
    container_name: mock-provider
    restart: unless-stopped
    ports:
      - "127.0.0.1:8000:8000"
    working_dir: /app
    volumes:
      - .:/app
    command: sh -c "pip install -i https://pypi.tuna.tsinghua.edu.cn/simple flask flask-cors && python local-llm/mock_provider.py"

networks:
  chatwoot_default:
    external: true
