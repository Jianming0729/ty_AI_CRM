# 一、AI 客服系统工程治理清单（可落地版）

## 1. 系统治理目标（先立法，再扩建）
**目标不是“AI 回答得多聪明”，而是：**
- 不幻觉
- 不越权
- 可回溯
- 可回滚
- 可替换

一句话原则：**AI 永远不是业务决策主体。**

---

## 2. 权责边界治理（必须工程化）

### 2.1 AI 允许做什么（Allow List）
- 业务规则解释（来自知识库）
- 流程说明（取车 / 还车 / 取消）
- 风险提示（违章、逾期、保险）
- 是否建议转人工（但不能拒绝人工）

### 2.2 AI 明确禁止做什么（Deny List）
- ❌ 修改订单
- ❌ 执行取消 / 改期
- ❌ 计算金额并给出“最终价格”
- ❌ 判断责任归属（如事故责任）
- ❌ 编造未写入知识库的政策

> **工程要求**：所有业务动作必须通过 API 网关，由后端系统二次校验。

---

## 3. 知识库（RAG）治理规范

### 3.1 知识来源要求
- 仅允许来自：
  - 官方租车规则
  - 合同条款
  - 公司内部政策文档
- 每条知识必须具备：
  - `source`
  - `version`
  - `effective_date`

### 3.2 RAG 命中原则
- 命中知识 → 才允许回答
- 未命中 → 固定兜底回复 + 转人工

**禁止 Prompt 中出现：**
- “你可以自行推断”
- “结合常见经验”

---

## 4. Prompt 与模型治理

### 4.1 Prompt 版本治理
- Prompt 必须：
  - 带版本号（v1.0.0）
  - 变更记录
  - 支持回滚

### 4.2 模型 Provider 解耦
- Dify / AI 层不得绑定具体模型
- Provider 可切换：
  - DeepSeek
  - 通义千问
  - Mock / 规则引擎

---

## 5. 幻觉防御与安全兜底

- 强制开启：
  - “仅基于知识库回答”模式
- 超出能力边界：
  - 明确说“不支持 / 请人工处理”

---

## 6. 审计与留痕（强烈建议一期就做）

- 会话 ID
- 使用的 Prompt 版本
- 命中的知识条目 ID
- 模型 Provider

---

## 7. 意图分发治理（解决“驴唇不对马嘴”）

### 7.1 分类模型优先
- 进入 RAG 检索前，必须先进行 **意图识别 (Intent Classification)**。
- 预设意图：
  - `INTENT_FAQ`: 询问政策/流程 -> 走 RAG。
  - `INTENT_ORDER`: 查询或操作订单 -> 走 API 工具链（带权限验证）。
  - `INTENT_TRANSFER`: 投诉/紧急求助 -> 立即转人工。
  - `INTENT_CHITCHAT`: 闲聊/无意义输入 -> 礼貌引导或拒答。

---

## 8. Testing & Verification

### 8.1. 开发与验证红线
*   **【铁律】禁止自动化 UI 测试**：除非用户明确授权，否则 AI 助手严禁调用 `browser_subagent` 或类似工具访问公网域名或本地 UI 服务。**手动验证（Manual Testing）** 是 UI/UX 和 访问流程正确性的唯一最终评判标准。
*   **【原则】AI 辅助，人脑决策**：AI 负责构建底层链路和日志排查，用户负责上层逻辑验证。

---

## 9. 企业微信实时性与超时治理

- **5秒原则**：企业微信回调必须在 5 秒内响应。
- **异步生成**：对于推理时间超过 3 秒的请求，Bridge 必须立即返回“正在为您查询...”，随后通过客服消息接口异步推送结果。
- **重试过滤**：严格通过 `MsgId` 去重，防止 AI 重复推理。

---

## 10. 营销与转化治理（Lead Generation）

- **合规线索收集**：AI 仅在用户表达明确需求（如：我想租、多少钱）时请求手机号。
- **隐私保护**：禁止 AI 在对话中直接询问银行卡号、支付密码。
- **线索自动入库**：命中营销意图后，自动生成 CRM 预选线索。

# 二、WeCom Bridge + Dify 安全调用接口规范

## 1. 总体原则
- Bridge 是**唯一入口**
- Dify 永远不直连企业微信

```
WeCom -> Bridge -> AI Gateway -> Dify -> Model
```

---

## 2. Bridge → AI Gateway（推荐）

### Request
```json
{
  "session_id": "uuid",
  "user_id": "wecom_user_id",
  "text": "用户原始输入",
  "channel": "wecom",
  "context": {
    "order_id": "optional",
    "scene": "pre_rent | in_rent | after_rent"
  }
}
```

### Response
```json
{
  "type": "ai_reply | transfer_human",
  "content": "文本内容",
  "confidence": "high | low",
  "knowledge_refs": ["KB-001", "KB-009"]
}
```

---

## 3. AI Gateway → Dify

- 仅传：
  - 清洗后的文本
  - 场景标签
- 不传真实用户隐私

---

# 三、可长期演进的智能客服架构图（文字版）

```
┌──────────────┐
│ 企业微信 WeCom │
└──────┬───────┘
       │
┌──────▼───────┐
│ WeCom Bridge  │  ← 你最核心的资产
└──────┬───────┘
       │
┌──────▼───────┐
│ AI Gateway    │  ← 权限、日志、兜底
└──────┬───────┘
       │
┌──────▼───────┐
│ Dify Platform │  ← RAG / Prompt / Workflow
└──────┬───────┘
       │
┌──────▼───────┐
│ Model Layer   │  ← DeepSeek / Qwen
└──────────────┘
```

演进方向：
- 可替换平台
- 可替换模型
- 可接入人工客服系统

---

# 四、对《桐叶智能客服+营销平台 二期演进方案》的关键修改建议（已吸收）

## 原方案风险点修正

### 1. ❌ AI 直接参与业务执行
→ **修改为：AI 仅生成建议，由系统或人工执行**

### 2. ❌ 未区分“平台能力”和“系统主权”
→ **明确：Dify 为能力平台，主系统仍在桐叶体系内**

### 3. ❌ 未提及 Prompt / 知识版本治理
→ **补充完整版本、审计、回滚机制**

### 4. ❌ 模型绑定风险
→ **改为 Provider 抽象层**

---

## 修改后的二期演进核心定位

> 二期目标不是“更聪明的 AI”，而是：
> **一个不会伤害业务的智能系统**。

---

# 五、下一步可交付建议

- 可生成：
  - Docker 私有化部署清单（Dify + Gateway）
  - 企业微信 → AI 灰度策略
  - 客服风险分级表（AI / 人工）

---

**本方案适用于：中国部署 + 国产大模型 + 长期演进系统。**

